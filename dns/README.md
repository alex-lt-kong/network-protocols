# DNS

To test the program, run `host -p 9000 foo.bar.com 127.0.0.1`
The initial copy of the code is from [mwarning's SimpleDNS](https://github.com/mwarning/SimpleDNS)
## Format

* A more detailed explanation of DNS message format can be found from [The TCP/IP Guide](http://www.tcpipguide.com/free/t_DNSMessageProcessingandGeneralMessageFormat.htm).

* The client/server information exchange in DNS is facilitated using query/response messaging. Both queries and responses have the same general format, containing up to five individual sections carrying information.

* Of these, two are usually found in both queries and responses: the Header section and the Question section.

<table>
    <thead>
        <tr>
            <th>Section Name</th>
            <th>Section Size (byte)</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Header</td>
            <td>12</td>
            <td>
                Contains fields that describe the type of message and provide important information about it.
                Also contains fields that indicate the number of entries in the other sections of the message.
            </td>
        </tr>
        <tr>
            <td>Question</td>
            <td>Variable</td>
            <td>
                Carries one or more “questions”, that is, queries for information being sent to a DNS name server.
                Note that common DNS service implementations support one question per query only.
            </td>
        </tr>
        <tr>
            <td>Resource Record Sections: Answer, Authority and Additional</td>
            <td>Variable</td>
            <td>
                 These sections share the same basic format, each carrying one or more resource records that
                 use a common record format. The number of records in each section is indicated using the “count”
                 fields in the message header. The sections differ only in terms of the types of records they
                 carry. Answer records are directly related to the question asked, while Authority records carry
                 resource records that identify other name servers. Authority records are thus the means by which
                 name servers are hierarchically “linked” when the server doesn't have the information the client
                 requested. The Additional section exists for the specific purpose of improving DNS efficiency. 
            </td>
        </tr>
    </tbody>
</table>

### Header section format

<table>
    <thead>
        <tr>
            <th>Field Name</th>
            <th>Field Size (byte)</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>ID</td>
            <td>2</td>
            <td>An 16-bit integer generated by client, helping it to match a response to a query</td>
        </tr>
        <tr>
            <td>QR</td>
            <td>1/8 (1 bit)</td>
            <td>Query/Response flag: used to differentiate if a message is a query or a response. A response should change it from 0 to 1</td>
        </tr>
        <tr>
            <td>Opcode</td>
            <td>1/2 (4 bits)</td>
            <td>
                Specify the type of query. Valid values are 0(query), 1(iquery), 2(status), 3(reserved), 4(notify) and 5(update).
                A server should copy this value unchanged from a query to a response.</td>
        </tr>
        <tr>
            <td>AA</td>
            <td>1/8 (1 bit)</td>
            <td>
                Authoritative Answer Flag: This bit is set to 1 in a response to indicate that the server that created
                the response is authoritative for the zone in which the domain name specified in the Question section is
                located. If it is 0, the response is non-authoritative.
            </td>
        </tr>
        <tr>
            <td>TC</td>
            <td>1/8 (1 bit)</td>
            <td>
                Truncation flag: Setting to 1 indicates that the message was truncated due to its length being longer
                than the maximum permitted for the type of transport mechanism used. Since TCP doesn't have a length
                limit, this option is applicable to UDP only
            </td>
        </tr>
        <tr>
            <td>RD</td>
            <td>1/8 (1 bit)</td>
            <td>Recursion Desired flag: When set in a query, requests that the server receiving the query attempt to answer the query recursively, if the server supports recursive resolution. The value of this bit is not changed in the response.</td>
        </tr>
        <tr>
            <td>RA</td>
            <td>1/8 (1 bit)</td>
            <td>
                Recursion Available flag: Set to 1 or cleared to 0 in a response to indicate whether
                the server creating the response supports recursive queries.
            </td>
        </tr>
        <tr>
            <td>Z</td>
            <td>3/8 (3 bits)</td>
            <td>Three reserved bits are always zero</td>
        </tr>
        <tr>
            <td>RCode</td>
            <td>1/2 (4 bits)</td>
            <td>Response Code: In a query, it should always be 0. In a response, valid values are from 1 to 10.</td>
        </tr>
        <tr>
            <td>QDCount</td>
            <td>2</td>
            <td>
                Question Count: Specifies the number of questions in the Question section of the message. Theoretically,
                DNS protocol supports multiple questions in one query. In reality, however, this seems to be not
                supported by mainstream implementations as shown <a href="https://stackoverflow.com/questions/4082081/requesting-a-and-aaaa-records-in-single-dns-query/4083071">here</a>.
            </td>
        </tr>
        <tr>
            <td>ANCount</td>
            <td>2</td>
            <td>Answer Record Count: Specifies the number of resource records in the Answer section of the message.</td>
        </tr>
        <tr>
            <td>NSCount</td>
            <td>2</td>
            <td>Authority Record Count: Specifies the number of resource records in the Authority section of the message. ("NS" stands for "name server")</td>
        </tr>
        <tr>
            <td>ARCount</td>
            <td>2</td>
            <td>Additional Record Count: Specifies the number of resource records in the Additional section of the message.</td>
        </tr>
    </tbody>
</table>

### Question section format

Question section is a subset of the Resource Record section.

<table>
    <thead>
        <tr>
            <th>Field Name</th>
            <th>Field Size (byte)</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>QName</td>
            <td>Variable</td>
            <td>
                Question Name: the queried domain name, encoded using standard DNS name notation.
                The "standard DNS name notation" encodes www.google.com to 3www6google3com0.
            </td>
        </tr>
        <tr>
            <td>QType</td>
            <td>2</td>
            <td>
                Question Type, such as 1 for A record and 5 for CNAME record. A list of valid values can be found
                from its <a href="https://en.wikipedia.org/wiki/List_of_DNS_record_types">Wikipedia entry</a>
            </td>
        </tr>
        <tr>
            <td>QClass</td>
            <td>2</td>
            <td>Question Class, specifies the class of the resource record being requested, normally the value 1 for Internet ("IN").</td>
        </tr>
    </tbody>
</table>

###  Resource Record sections (Answer, Authority and Additional) format

Resource Record section is a super-set of the Question section.

<table>
    <thead>
        <tr>
            <th>Field Name</th>
            <th>Field Size (byte)</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Name</td>
            <td>Variable</td>
            <td>Same as QName under `Question` section</td>
        </tr>
        <tr>
            <td>Type</td>
            <td>2</td>
            <td>Same as QType under `Question` section</td>
        </tr>
        <tr>
            <td>Class</td>
            <td>2</td>
            <td>Same as QClass under `Question` section</td>
        </tr>
        <tr>
            <td>TTL</td>
            <td>2</td>
            <td>
                Time To Live: Specifies the number of seconds that the record
                should be retained in the cache of the client. 0 means disabling
                cache.
            </td>
        </tr>
        <tr>
            <td>RDLength</td>
            <td>2</td>
            <td>
                Resource Data Length: Indicates the size of the RData field, in bytes.
            </td>
        </tr>
    </tbody>
</table>